---
layout: post
title: Implementación del patrón Singleton en Scala
date: '2010-06-10T21:39:00.000+01:00'
author: Yeray Darias
tags: [code, scala, patterns, spanish]
modified_time: '2010-06-10T21:39:17.175+01:00'
---

Saludos a todo el mundo (o todo el mundo que lea este blog). Como estoy un poco liado con otras entradas referentes a la charla de integración continua en Agile-Canarias, hoy hablaré de un tema sencillo que me ha surgido esta semana. Como implementar el patrón Singleton en Scala.<br /><br />Para empezar y para todos aquellos que no sepan lo que es el patrón Singleton, se puede resumir en que es un patrón de diseño que permite mantener una única instancia de un determinado objeto. Esto es muy útil cuando se trata de un objeto cuya instanciación es muy costosa o simplemente porque modela un elemento que es único en la realidad.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_DSGPSDpA_pM/TBFEBa4o9eI/AAAAAAAAB1o/O7S3X4Sj11k/s1600/diagrama.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_DSGPSDpA_pM/TBFEBa4o9eI/AAAAAAAAB1o/O7S3X4Sj11k/s320/diagrama.png" /></a></div><br />A partir del diagrama de clase anterior nos podemos hacer una idea de su implementación en un lenguaje como por ejemplo Java, pero para que quede más claro, aquí va el código de un Singleton en Java :-) Esta sacado de la Wikipedia y es tan solo un ejemplo ilustrativo así que no le intentéis buscar un sentido más allá de ser un simple ejemplo (aunque como ejemplo funciona bien).<br /><br /><pre><code><br />public class Singleton {<br /><br />   private static final Singleton instance = new Singleton();<br /><br />   ...<br /> <br />   // El constructor privado impide la instanciación<br />   private Singleton() {}<br /> <br />   public static Singleton getInstance() {<br />      return instance;<br />   }<br /><br />   ...<br /><br />}<br /></code></pre><br />Ahora bien, si en Scala no disponemos del modificador static, cómo vamos a hacer esto?!?!?!?! Pues es muy sencillo, igual que hacemos para simular los métodos estáticos, con la declaración object en vez de class, es decir.<br /><br /><pre><code><br />object SingletonContainer {<br /><br />   val singleton = ... ; // instanciación desde una Factoría<br /><br />   def getInstance: Singleton = {<br />      return singleton;<br />   }<br /><br />}<br /></code></pre><br />Como imagino que ya os habréis fijado, esta clase Java que yo he llamado Singleton, en la vida real tendrá más líneas de código referentes a su utilidad en el sistema que estemos implementando, pero para nosotros estarán contenidas en los puntos suspensivos (...) En Scala no es posible hacer un new Singleton, porque se trata de un object, pero podemos tener una factoría para crear una instancia del objeto deseado "de la clase Singleton", mientras que SingletonContainer sirve para mantener la referencia única. <br /><br />Además como a todos nos gustar escribir poco, voy a dar una aproximación aún más corta a la implementación con Scala.<br /><br /><pre><code><br />object SingletonContainer {<br /><br />   val getInstance = ... ; // instanciación desde una Factoría<br /><br />}<br /></code></pre><br />Más corto imposible :-) Pero seguro que muchos esto les suena raro porque el patrón Singleton suele ser autocontenido, es decir que no hay contenedor que instancia a otra clase mediante una factoría. Pues claro!!! Bien, por defecto en Scala un object es un Singleton en sí mismo, así que realmente no teníamos que hacer nada de nada, ¿por qué he hecho yo esto? Porque en algunos casos es simplemente necesario tener una instancia única que en realidad es de otra clase distinta, y este es el método más sencillo que he encontrado, de forma que mi código real es algo como lo siguiente.<br /><br /><pre><code><br />object BaseSemanticModel {<br /><br />  val getInstance = SemanticUtils.loadModelFromResourceFile(...);<br />  <br />}<br /></code></pre><br />De esta forma ahora tengo una instancia de Model (que es una clase de Jena, lo cual no viene a cuento ahora :-) que funciona como un Singleton en tan solo unas pocas líneas. Pero si BaseSemanticModel fuese la clase de la que quiero el Singleton, no tengo que hacer nada más que la implementación de la misma, porque luego la referencia a BaseSemanticModel es única y funciona como un Singleton en Scala. <br /><br />Espero que me hayáis entendido, porque creo que ni yo mismo lo hago y que le sirva de algo a alguien.